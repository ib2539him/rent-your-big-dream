"use strict";const autoprefixer=require("autoprefixer"),browsersync=require("browser-sync").create(),cssnano=require("cssnano"),gulp=require("gulp"),postcss=require("gulp-postcss"),rename=require("gulp-rename"),minify=require("gulp-clean-css"),fileInclude=require("gulp-file-include"),through2=require("through2"),beautify=require("gulp-beautify"),sass=require("gulp-sass")(require("sass")),terser=require("gulp-terser"),uglify=require("gulp-uglify"),replace=require("gulp-replace"),fs=require("fs");gulp.task("css",()=>gulp.src(["assets/*.css","assets/scss/*.scss","assets/scss/*.css"]).pipe(sass({outputStyle:"expanded"})).pipe(rename({suffix:".min"})).pipe(postcss([autoprefixer(),cssnano()])).pipe(minify()).pipe(gulp.dest("docs/css")).pipe(browsersync.stream())),gulp.task("webfonts",()=>gulp.src("assets/fonts/**/*.{ttf,woff,woff2,eot,svg}").pipe(gulp.dest("docs/fonts"))),gulp.task("images",()=>gulp.src("assets/image/**/*.{svg,gif,webp,png,jpg,jpeg}").pipe(gulp.dest("docs/image"))),gulp.task("fileInclude",()=>{const t=JSON.parse(fs.readFileSync("scripts.json"));return gulp.src("html/*.html").pipe(through2.obj(function(s,e,r){const i=s.contents.toString(),p={};t.sections.forEach(s=>{var e=new RegExp(`<!--\\s*@@include\\("${s.include}"\\)\\s*-->`).test(i);p[s.name]=i.includes(`@@include("${s.include}")`)&&!e}),s.flags=p,s.needScriptsJson=Object.values(p).some(s=>!0===s),r(null,s)})).pipe(replace("\x3c!-- headScriptsJson --\x3e",function(s){return this.file.needScriptsJson?'<script src="scripts.json" defer><\/script>\n':""})).pipe(fileInclude({prefix:"@@",basepath:"@file"})).pipe(replace(/<!--\s*build:([^ ]+?)\s*-->[\s\S]*?<!--\s*endbuild\s*-->/g,function(s,e){var r=t.sections.find(s=>s.name===e);return r&&this.file.flags[r.name]?`<script src="${r.script}"  defer></script>`:""})).pipe(replace("\x3c!-- headScripts --\x3e",function(s){let e="";return t.sections.forEach(s=>{s.headScript&&this.file.flags[s.name]&&(e+=`<script src="${s.headScript}"  defer></script>
`)}),e})).pipe(gulp.dest("docs")).pipe(beautify.html({indent_size:2})).pipe(browsersync.stream())}),gulp.task("js",()=>gulp.src(["assets/*.js","assets/js/**/*.js","assets/js/*.js"]).pipe(terser()).pipe(uglify()).pipe(gulp.dest("docs/js")).pipe(browsersync.stream())),gulp.task("watch",()=>{browsersync.init({server:{baseDir:"docs/"},host:"localhost",port:5e3,open:!0,tunnel:!0,online:!1}),gulp.watch("assets/scss/**/*",gulp.series("css")),gulp.watch("html/*.html",gulp.series("fileInclude")),gulp.watch("assets/scss/web/*",gulp.series("webfonts")),gulp.watch("assets/image/**/*.{svg,gif}",gulp.series("images")),gulp.watch("assets/js/*.js",gulp.series("js"))}),gulp.task("default",gulp.parallel("css","webfonts","images","fileInclude","js","watch"));